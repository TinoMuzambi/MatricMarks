---
title: "Matric Marks"
author: "Tino Muzambi"
date: "`r Sys.Date()`"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Libraries
```{r}
library(tidyverse)
```


# Read data
```{r}
bachelor.pass <- read.csv("./data/South_Africa_Bachelor_passes_by_province.csv") %>% as_tibble()
maths <- read.csv("./data/South_Africa_Bachelor_passes_by_province.csv") %>% as_tibble()
physics <- read.csv("./data/South_Africa_National_Senior_Certificate_Physical_Science_results_v2.csv") %>% as_tibble()
```

# Look at data
```{r}
summary(bachelor.pass)

summary(maths)

summary(physics)
```

# Clean up data
```{r}
# Drop date & percent
bachelor.pass <- bachelor.pass %>% 
  select(-date, -contains("percent"))

maths <- maths %>% 
  select(-date, -contains("percent"))

physics <- physics %>% 
  select(-date)

```

# Pivot Longer
```{r}
bachelor.pass.long <- bachelor.pass %>%
pivot_longer(
    cols = c(starts_with("zaf"), starts_with("ec"), starts_with("fs"),
             starts_with("gp"), starts_with("kzn"), starts_with("lp"),
             starts_with("mp"), starts_with("nw"), starts_with("nc"),
             starts_with("wc")),
    names_to = c("province", "ignore1", "data1", "data2","ignore2", "ignore3", "ignore4"),
    names_sep = "_",
    values_to = "value"
  ) %>%
  select(matric_class, province, data1, data2, value) %>% 
  mutate(type = case_when(
    grepl("passed", data1) | grepl("passed", data2) ~ "passed",
    grepl("wrote", data1) | grepl("wrote", data2) ~ "wrote"
  )) %>% 
  select(-c("data1", "data2"))
```

# Replace provinces with full name
```{r}
province.names <- c("zaf" = "South Africa", "ec" = "Eastern Cape", "fs" = "Free State", "gp" = "Gauteng",
                    "kzn" = "KwaZulu-Natal", "lp" = "Limpopo", "mp" = "Mpumalanga", "nw" = "North West",
                    "nc" = "Northern Cape", "wc" = "Western Cape")

bachelor.pass.long <- bachelor.pass.long %>% 
  mutate(province = province.names[province])
```

# Pivot Maths Longer
```{r}
maths.long <- maths %>%
pivot_longer(
    cols = c(starts_with("zaf"), starts_with("ec"), starts_with("fs"),
             starts_with("gp"), starts_with("kzn"), starts_with("lp"),
             starts_with("mp"), starts_with("nw"), starts_with("nc"),
             starts_with("wc")),
    names_to = c("province", "ignore1", "data1", "data2","ignore2", "ignore3", "ignore4"),
    names_sep = "_",
    values_to = "value"
  ) %>%
  select(matric_class, province, data1, data2, value) %>% 
  mutate(type = case_when(
    grepl("passed", data1) | grepl("passed", data2) ~ "passed",
    grepl("wrote", data1) | grepl("wrote", data2) ~ "wrote"
  )) %>% 
  select(-c("data1", "data2")) %>% 
  mutate(province = province.names[province])
```

Pivot Physics Longer
```{r}
physics.long <- physics %>%
pivot_longer(
    cols = c(starts_with("zaf"), starts_with("ec"), starts_with("fs"),
             starts_with("gp"), starts_with("kzn"), starts_with("lp"),
             starts_with("mp"), starts_with("nw"), starts_with("nc"),
             starts_with("wc")),
    names_to = c("province", "ignore1", "ignore2", "ignore3","ingore4", "pass.rate"),
    names_sep = "_",
    values_to = "value"
  ) %>%
  select(matric_class, province, data1, data2, value) %>% 
  mutate(type = case_when(
    grepl("passed", data1) | grepl("passed", data2) ~ "passed",
    grepl("wrote", data1) | grepl("wrote", data2) ~ "wrote"
  )) %>% 
  select(-c("data1", "data2")) %>% 
  mutate(province = province.names[province])
```


# Line chart of all provinces pass and wrote.
```{r}
all.provinces.plot <- bachelor.pass.long %>% 
  ggplot(aes(x = matric_class, y = value, color = type, group = interaction(province, type))) +
  geom_line() +
  facet_wrap(~province, scales = "free_y") +
  labs(x = "Matric Class", y = "Number of Learners", color = "Type") +
  theme_minimal()
all.provinces.plot
```

